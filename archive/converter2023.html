<!doctype html>
<html lang="en">
<!-- 3.25.23
FINALLY! got steq-jul to work!-->
<head>
<title>STEQ file generator | Sun Times Equivalence Thing</title>
<link rel="stylesheet" href="steq20240407.css">
<meta charset=UTF-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--favicon code -->
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#44bbff">
<meta name="msapplication-TileColor" content="#2b5797">
<meta name="theme-color" content="#ffffff">
<!-- end -->
</head>
<body>
<div class="top">
<svg viewBox = "0 0 120 120">
<circle cx="60" cy="60" r="56" fill="#ffde72" stroke="black" stroke-width="2"/>
<line x1="60" y1="60" x2="105" y2="66" style="stroke:rgb(0,0,0);stroke-width:2" />
<line x1="60" y1="60" x2="90" y2="48" style="stroke:rgb(0,0,0);stroke-width:2" />
</svg>
<span class="white">STEQ file generator</span>
</div>
<div id="content">
<p>Archived version from March 2023.</p>
<hr>
<p>File generator</p>
<span class="ib"><label for="type">File type: </label>
<select id="type" size="1" class="mockbutton">
<option value="0">STEQ-POL</option>
<option value="1">STEQ-NDL</option>
<option value="2">STEQ-DYN</option>
<option value="3">STEQ-JUL</option>
<option value="4">(no file type)</option>
</select></span><br>
<span class="ib"><label for="name">Place name: </label><input type="text" id="name" class="mockbutton"/></span><br>
<span class="ib"><label for="lat">Latitude: </label><input type="number" id="lat" name="lat" min="-90" max="90" class="mockbutton"/></span><br>
<span class="ib"><label for="lon">Longitude: </label><input type="number" id="lon" name="lon" min="-180" max="180" class="mockbutton"/></span><br>
<span class="ib"><label for="tz">Time zone (winter): </label><input type="number" id="tz" name="tz" min="-12" max="14" class="mockbutton"/></span><br>
<span class="ib"><label for="dst">DST rule: </label>
<select id="dst" size="1" class="mockbutton">
<option value="no">no</option>
<option value="us">us</option>
<option value="eu">eu</option>
</select></span><br>
<button id="gen" class="mockbutton" onclick="validate();">Go</button>
<p id="dirs">Copy the text below and paste it into a text-editing program such as Notepad. Save it under whatever name you'd like with the file extention .steq. You can then visit the Sun Times Equivalence Thing and upload the file you just created.</p>
<p id="invalid" class="error"></p>
<p id="disp"></p>
<p><a href="./">Back to the archive</a></p>
</div>
<script src="gen.js"></script>
<script src="dst.js"></script>
<script src="computeSunrise2.js"></script>
<script>
function validate() {
var name = document.getElementById('name').value;
var lat = parseFloat(document.getElementById('lat').value);
var lon = parseFloat(document.getElementById('lon').value);
var tz = parseFloat(document.getElementById('tz').value);
var dst = document.getElementById('dst').value;
var type = document.getElementById('type').value;
if (name === "") {
	name = lat + ", " + lon;
	};
var errors = "";
if (isNaN(lat) || lat < -90 || lat > 90 ) {
errors+= "Latitude must be between -90 and 90.<br>";
};
if (isNaN(lon) || lon < -180 || lon > 180) {
errors+= "Longitude must be between -180 and 180.<br>";
};
if (isNaN(tz) || tz < -12 || tz > 14) {
errors+= "Time zone must be between -12 and 14. (Use decimals for half hours.)<br>";
};
if (errors === "") {
display(make(lat, lon, tz, dst, 2024, type));
} else {
document.getElementById("invalid").innerHTML = errors;
document.getElementById('invalid').style.display = 'block';
};
};
var file = "";
function make(lat, lon, tz, dst, year, type) {
var name = document.getElementById('name').value;
if (name === "") {
	name = lat + ", " + lon;
	};
var raw = generate(lat, lon, tz, "no", year);
polarFlag = 0;
if (raw.toString().indexOf("*") !== -1 || raw.toString().indexOf("-") !== -1) {
	polarFlag = 1;
	};
if (type === "1") {
	name = name.replace(/ /g, "&")
	file = "STEQ-NDL " + name + " " + raw + dst;
	};
if (type === "0") {
	name = name.replace(/ /g, "&")
	file = "STEQ-POL " + name + " " + raw + dst; //only other differences are "NULL" and "d" but... they're not supported by this...
	};
if (type === "2") {
	name = name.replace(/ /g, "&")
	var loaded = raw.split(" ")
	sunrises = loaded.slice(0, 366);
	sunsets = loaded.slice(366, 732);
	//make daylight, pulled from steqintl3b4
	var sunrisemin;
	var sunsetmin;
	var daylightmin;
	var zstring;
	var dstrule;
	var daylightduration = [];
	for (i=0; i<sunrises.length; i++) {
		zstring = "";
		sunrisemin = parseInt(sunrises[i].substring(0,2))*60 + parseInt(sunrises[i].substring(2,4));
		sunsetmin = parseInt(sunsets[i].substring(0,2))*60 + parseInt(sunsets[i].substring(2,4));
		daylightmin = sunsetmin - sunrisemin; 
		if (daylightmin < 0) {
			daylightmin = 1440 - Math.abs(daylightmin);
			}; //this is to prevent negative daylight. i was playing around and had a location with a wildly wrong time zone
		if (daylightmin % 60 < 10) {
			zstring = "0";
			};
		daylightmin = Math.floor(daylightmin / 60) + ":" + zstring + (daylightmin % 60);
		if (daylightmin.length < 5) {
			daylightmin = "0" + daylightmin;
			};
		daylightduration += daylightmin + " ";
		};
	file = "STEQ-DYN " + name + " " + raw + daylightduration + dst;
	};
if (type === "3") {
name = name.replace(/ /g, "&")
var dyn = make(lat, lon, tz, dst, 2024, "2");
var loaded = dyn.split(" ");
sunrises = loaded.slice(2, 368);
sunsets = loaded.slice(368, 734);
daylight = loaded.slice(734, 1100);
var sunriseh = [];
var sunrisem = [];
for (i=0; i<sunrises.length; i++) {
sunriseh.push(sunrises[i].slice(0, 2));
sunrisem.push(sunrises[i].slice(2, 4));
if (sunriseh[i].slice(0, 1) === "0") {
	sunriseh[i] = sunriseh[i].slice(1, 2);
	};
if (parseInt(sunriseh[i]) < 12) {
	sunrisem[i] = ":"+sunrisem[i]+"&AM";
	} else {
	sunrisem[i] = ":"+sunrisem[i]+"&PM";
	sunriseh[i] = (parseInt(sunriseh[i])-12).toString();
	};
};
var sunseth = [];
var sunsetm = [];
for (i=0; i<sunsets.length; i++) {
sunseth.push(sunsets[i].slice(0, 2));
sunsetm.push(sunsets[i].slice(2, 4));
if (sunseth[i].slice(0, 1) === "0") {
	sunseth[i] = sunseth[i].slice(1, 2);
	};
if (parseInt(sunseth[i]) < 12) {
	sunsetm[i] = ":"+sunsetm[i]+"&AM";
	} else {
	sunsetm[i] = ":"+sunsetm[i]+"&PM";
	sunseth[i] = (parseInt(sunseth[i])-12).toString();
	};
};
for (i=0; i<daylight.length; i++) {
	if (daylight[i].slice(0, 1) === "0") {
	daylight[i] = daylight[i].slice(1, 5);
	};
daylight[i] = daylight[i].replaceAll(":", "&hours&");
daylight[i] = daylight[i] + "&minutes"
};
console.log(sunriseh, sunrisem, sunseth, sunsetm, daylight);
file = "STEQ-JUL " + name + " " + sunriseh.toString().replaceAll(","," ") + " " + sunrisem.toString().replaceAll(","," ") + " " + sunseth.toString().replaceAll(","," ") + " " + sunsetm.toString().replaceAll(","," ") + " " + daylight.toString().replaceAll(","," ") + " " + dst;
}
if (type === "4") {
var jul = make(lat, lon, tz, dst, 2024, "3");
file = jul.slice(9,jul.length);
};
return file;
};
function display(output) {
document.getElementById('dirs').style.display = 'block';
document.getElementById('invalid').style.display = 'none';
document.getElementById("disp").style.display = 'block';
document.getElementById("disp").innerHTML = "<code>"+output+"</code>";
if (polarFlag === 1) {
document.getElementById("invalid").style.display = "block";
document.getElementById("invalid").innerHTML = "Your location has one or more days where the sun is above or below the horizon for the entire day. No versions of the Sun Times Equivalence Thing that support STEQ files support this situation, and STEQ-POL is the only STEQ file format that does.";
if (document.getElementById("type").value !== "0") {
document.getElementById("disp").style.display = 'none';
document.getElementById('dirs').style.display = 'none';
};
};
};
</script>